(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{448:function(t,a,s){"use strict";s.r(a);var e=s(17),n=function(t){t.options.__data__block__={mermaid_64a5709e:"sequenceDiagram\n  autonumber\n  participant A as API Server\n  participant E as Endpoint<br />Controller\n  participant P as Kube-Proxy\n  participant D as CoreDNS\n  Note left of A: service.yml\n\n  loop\n    E->>A: Service 감시\n    E->>A: Endpoint 생성\n  end\n\n  loop\n    P->>A: Endpoint 감시\n  end\n\n  Note right of P: Endpoint 변경시<br />iptables 설정\n\n  loop\n    D->>A: Service 감시\n  end\n\n  Note right of D: Service 변경시<br />CoreDNS 설정\n"}},r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[t._v("#")]),t._v(" Service")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("⚡️ 목표")]),t._v(" "),s("p",[t._v("Service(서비스)를 이용하여 Pod을 노출하고 클러스터 외부에서 접근할 수 있는 방법을 알아봅니다.")])]),t._v(" "),s("p",[t._v("Pod은 자체 IP를 가지고 다른 Pod과 통신할 수 있지만, 쉽게 사라지고 생성되는 특징 때문에 직접 통신하는 방법은 권장하지 않습니다. 쿠버네티스는 Pod과 직접 통신하는 방법 대신, 별도의 고정된 IP를 가진 서비스를 만들고 그 서비스를 통해 Pod에 접근하는 방식을 사용합니다.")]),t._v(" "),s("div",{staticStyle:{"text-align":"center",width:"420px","max-width":"100%",margin:"0 auto"}},[s("custom-image",{attrs:{src:"/imgs/guide/service/pod-service.png",alt:"Service"}})],1),t._v(" "),s("p",[t._v("이러한 개념은 "),s("s",[t._v("도커에 익숙할수록")]),t._v(" 처음 접하면 참 어렵습니다. 개념도 생소한데 노출 범위에 따라 CluterIP, NodePort, LoadBalancer 타입으로 나누어져 더욱 헷갈립니다. 하나씩 차근차근 알아봅시다.")]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#service-clusterip-만들기"}},[t._v("Service(ClusterIP) 만들기")])]),s("li",[s("a",{attrs:{href:"#service-생성-흐름"}},[t._v("Service 생성 흐름")])]),s("li",[s("a",{attrs:{href:"#service-nodeport-만들기"}},[t._v("Service(NodePort) 만들기")])]),s("li",[s("a",{attrs:{href:"#service-loadbalancer-만들기"}},[t._v("Service(LoadBalancer) 만들기")]),s("ul",[s("li",[s("a",{attrs:{href:"#minikube에-가상-loadbalancer-만들기"}},[t._v("minikube에 가상 LoadBalancer 만들기")])])])]),s("li",[s("a",{attrs:{href:"#마무리"}},[t._v("마무리")])]),s("li",[s("a",{attrs:{href:"#참고"}},[t._v("참고")])]),s("li",[s("a",{attrs:{href:"#문제"}},[t._v("문제")])])])]),s("p"),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("서비스 종류")]),t._v(" "),s("p",[t._v("서비스 종류 중에 "),s("code",[t._v("ExternalName")]),t._v("도 있지만 여기서는 다루지 않습니다.")])]),t._v(" "),s("h2",{attrs:{id:"service-clusterip-만들기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service-clusterip-만들기"}},[t._v("#")]),t._v(" Service(ClusterIP) 만들기")]),t._v(" "),s("p",[t._v("ClusterIP는 클러스터 내부에 새로운 IP를 할당하고 여러 개의 Pod을 바라보는 로드밸런서 기능을 제공합니다. 그리고 서비스 이름을 내부 도메인 서버에 등록하여 Pod 간에 서비스 이름으로 통신할 수 있습니다.")]),t._v(" "),s("p",[t._v("그럼, "),s("RouterLink",{attrs:{to:"/guide/pod.html#다중-컨테이너"}},[t._v("다중 컨테이너")]),t._v("를 설명할 때 만들었던, counter 앱 중에 redis를 서비스로 노출해보겠습니다.")],1),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br")]),s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" db\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" db\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" db\n")])])]),s("code-link",{attrs:{link:"guide/service/counter-redis-svc.yml"}}),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("구분자")]),t._v(" "),s("p",[t._v('하나의 YAML파일에 여러 개의 리소스를 정의할 땐 "---"를 구분자로 사용합니다.')])]),t._v(" "),s("p",[t._v("redis를 먼저 만들어 봅니다.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("kubectl apply -f counter-redis-svc.yml\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Pod, ReplicaSet, Deployment, Service 상태 확인")]),t._v("\nkubectl get all\n")])])]),s("p",[s("strong",[t._v("실행 결과")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("NAME                         READY   STATUS    RESTARTS   AGE\npod/redis-57d787df44-mf5w5   1/1     Running   0          10s\n\nNAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\nservice/kubernetes   ClusterIP   10.96.0.1       <none>        443/TCP    3d19h\nservice/redis        ClusterIP   10.103.50.102   <none>        6379/TCP   10s\n\nNAME                    READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/redis   1/1     1            1           10s\n\nNAME                               DESIRED   CURRENT   READY   AGE\nreplicaset.apps/redis-57d787df44   1         1         1       10s\n")])])]),s("p",[t._v("redis Deployment와 Service가 생성된 것을 볼 수 있습니다.")]),t._v(" "),s("div",{staticStyle:{"text-align":"center",width:"170px","max-width":"100%",margin:"0 auto"}},[s("custom-image",{attrs:{src:"/imgs/guide/service/clusterip.png",alt:"ClusterIp"}})],1),t._v(" "),s("p",[t._v("같은 클러스터에서 생성된 Pod이라면 "),s("code",[t._v("redis")]),t._v("라는 도메인으로 redis Pod에 접근 할 수 있습니다. ("),s("code",[t._v("redis.default.svc.cluster.local")]),t._v("로도 접근가능 합니다. 서로 다른 namespace와 cluster를 구분할 수 있습니다.)")]),t._v(" "),s("p",[t._v("CluterIP 서비스의 설정을 살펴봅니다.")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("정의")]),t._v(" "),s("th",[t._v("설명")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("spec.ports.port")])]),t._v(" "),s("td",[t._v("서비스가 생성할 Port")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("spec.ports.targetPort")])]),t._v(" "),s("td",[t._v("서비스가 접근할 Pod의 Port (기본: port랑 동일)")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("spec.selector")])]),t._v(" "),s("td",[t._v("서비스가 접근할 Pod의 label 조건")])])])]),t._v(" "),s("p",[t._v("redis Service의 selector는 redis Deployment에 정의한 label을 사용했기 때문에 해당 Pod을 가리킵니다. 그리고 해당 Pod의 6379 포트로 연결하였습니다.")]),t._v(" "),s("p",[t._v("이제 redis에 접근할 counter 앱을 Deployment로 만듭니다.")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ghcr.io/subicura/counter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" REDIS_HOST\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis"')]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" REDIS_PORT\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6379"')]),t._v("\n")])])]),s("code-link",{attrs:{link:"guide/service/counter-app.yml"}}),t._v(" "),s("p",[t._v("counter app Pod에서 redis Pod으로 접근이 되는지 테스트 해보겠습니다.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("kubectl apply -f counter-app.yml\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# counter app에 접근")]),t._v("\nkubectl get po\nkubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it counter-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("xxxxx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -- "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl localhost:3000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl localhost:3000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# telnet redis 6379")]),t._v("\n  dbsize\n  KEYS *\n  GET count\n  quit\n")])])]),s("p",[t._v("Service를 통해 Pod과 성공적으로 연결되었습니다.")]),t._v(" "),s("h2",{attrs:{id:"service-생성-흐름"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service-생성-흐름"}},[t._v("#")]),t._v(" Service 생성 흐름")]),t._v(" "),s("p",[t._v("Service는 각 Pod를 바라보는 로드밸런서 역할을 하면서 내부 도메인서버에 새로운 도메인을 생성합니다. Service가 어떻게 동작하는지 살펴봅니다.")]),t._v(" "),s("pre",{staticClass:"mermaid-container"},[s("code",[s("Mermaid",{attrs:{id:"mermaid_64a5709e",graph:t.$dataBlock.mermaid_64a5709e}})],1)]),s("ol",[s("li",[s("code",[t._v("Endpoint Controller")]),t._v("는 "),s("code",[t._v("Service")]),t._v("와 "),s("code",[t._v("Pod")]),t._v("을 감시하면서 조건에 맞는 Pod의 IP를 수집")]),t._v(" "),s("li",[s("code",[t._v("Endpoint Controller")]),t._v("가 수집한 IP를 가지고 "),s("code",[t._v("Endpoint")]),t._v(" 생성")]),t._v(" "),s("li",[s("code",[t._v("Kube-Proxy")]),t._v("는 "),s("code",[t._v("Endpoint")]),t._v(" 변화를 감시하고 노드의 iptables을 설정")]),t._v(" "),s("li",[s("code",[t._v("CoreDNS")]),t._v("는 "),s("code",[t._v("Service")]),t._v("를 감시하고 서비스 이름과 IP를 "),s("code",[t._v("CoreDNS")]),t._v("에 추가")])]),t._v(" "),s("p",[s("code",[t._v("iptables")]),t._v("는 커널"),s("sup",[t._v("kernel")]),t._v(" 레벨의 네트워크 도구이고 "),s("code",[t._v("CoreDNS")]),t._v("는 빠르고 편리하게 사용할 수 있는 클러스터 내부용 도메인 네임 서버 입니다. 각각의 역할은 "),s("code",[t._v("iptables")]),t._v(" 설정으로 여러 IP에 트래픽을 전달하고 "),s("code",[t._v("CoreDNS")]),t._v("를 이용하여 IP 대신 도메인 이름을 사용합니다.")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("iptables")]),t._v(" "),s("p",[t._v("iptables는 규칙이 많아지면 성능이 느려지는 이슈가 있어, "),s("code",[t._v("ipvs")]),t._v("를 사용하는 옵션도 있습니다.")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("CoreDNS")]),t._v(" "),s("p",[t._v("CoreDNS는 클러스터에서 호환성을 위해 "),s("code",[t._v("kube-dns")]),t._v("라는 이름으로 생성됩니다.")])]),t._v(" "),s("p",[t._v("갑자기 Endpoint가 나왔습니다. Endpoint는 서비스의 접속 정보를 가지고 있습니다. Endpoint의 상태를 확인해 보겠습니다.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("kubectl get endpoints\nkubectl get ep "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#줄여서")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redis Endpoint 확인")]),t._v("\nkubectl describe ep/redis\n")])])]),s("p",[s("strong",[t._v("실행 결과")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Name:         redis\nNamespace:    default\nLabels:       <none>\nAnnotations:  endpoints.kubernetes.io/last-change-trigger-time: ...\nSubsets:\n  Addresses:          172.17.0.2\n  NotReadyAddresses:  <none>\n  Ports:\n    Name     Port  Protocol\n    ----     ----  --------\n    <unset>  6379  TCP\n\nEvents:  <none>\n")])])]),s("p",[t._v("Endpoint Addresses 정보에 Redis Pod의 IP가 보입니다. (Replicas가 여러개였다면 여러 IP가 보입니다.)")]),t._v(" "),s("h2",{attrs:{id:"service-nodeport-만들기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service-nodeport-만들기"}},[t._v("#")]),t._v(" Service(NodePort) 만들기")]),t._v(" "),s("p",[t._v("CluterIP는 클러스터 내부에서만 접근할 수 있습니다. 클러스터 외부(노드)에서 접근할 수 있도록 NodePort 서비스를 만들어봅니다.")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("np\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NodePort\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodePort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("31000")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app\n")])])]),s("code-link",{attrs:{link:"guide/service/counter-nodeport.yml"}}),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("정의")]),t._v(" "),s("th",[t._v("설명")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("spec.ports.nodePort")])]),t._v(" "),s("td",[t._v("노드에 오픈할 Port (미지정시 30000-32768 중에 자동 할당)")])])])]),t._v(" "),s("p",[t._v("counter app을 해당 노드의 31000으로 오픈합니다.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("kubectl apply -f counter-nodeport.yml\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 서비스 상태 확인")]),t._v("\nkubectl get svc\n")])])]),s("p",[s("strong",[t._v("실행 결과")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE\ncounter-np   NodePort    10.101.168.165   <none>        3000:31000/TCP   13s\nkubernetes   ClusterIP   10.96.0.1        <none>        443/TCP          3d19h\nredis        ClusterIP   10.103.50.102    <none>        6379/TCP         30m\n")])])]),s("p",[s("code",[t._v("minikube ip")]),t._v("로 테스트 클러스터의 노드 IP를 구하고 31000으로 접근해봅니다.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".64.4:31000 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 또는 브라우저에서 접근")]),t._v("\n")])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("Docker")]),t._v(" "),s("p",[t._v("Docker driver를 사용중이라면 "),s("code",[t._v("minikube service counter-np")]),t._v(" 명령어를 이용하여 접속하세요.")])]),t._v(" "),s("div",{staticStyle:{"text-align":"center",width:"350px","max-width":"100%",margin:"0 auto"}},[s("custom-image",{attrs:{src:"/imgs/guide/service/nodeport.png",alt:"NodePort"}})],1),t._v(" "),s("p",[t._v("NodePort는 클러스터의 모든 노드에 포트를 오픈합니다. 지금은 테스트라서 하나의 노드밖에 없지만 여러 개의 노드가 있다면 아무 노드로 접근해도 지정한 Pod으로 쏘옥 접근할 수 있습니다.")]),t._v(" "),s("div",{staticStyle:{"text-align":"center",width:"550px","max-width":"100%",margin:"0 auto"}},[s("custom-image",{attrs:{src:"/imgs/guide/service/nodeport-multi.png",alt:"NodePort"}})],1),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("NodePort와 ClusterIP")]),t._v(" "),s("p",[t._v("NodePort는 CluterIP의 기능을 기본으로 포함합니다.")])]),t._v(" "),s("h2",{attrs:{id:"service-loadbalancer-만들기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service-loadbalancer-만들기"}},[t._v("#")]),t._v(" Service(LoadBalancer) 만들기")]),t._v(" "),s("p",[t._v("NodePort의 단점은 노드가 사라졌을 때 자동으로 다른 노드를 통해 접근이 불가능하다는 점입니다. 예를 들어, 3개의 노드가 있다면 3개 중에 아무 노드로 접근해도 NodePort로 연결할 수 있지만 어떤 노드가 살아 있는지는 알 수가 없습니다.")]),t._v(" "),s("div",{staticStyle:{"text-align":"center",width:"460px","max-width":"100%",margin:"0 auto"}},[s("custom-image",{attrs:{src:"/imgs/guide/service/lb.png",alt:"Load Balancer"}})],1),t._v(" "),s("p",[t._v("자동으로 살아 있는 노드에 접근하기 위해 모든 노드를 바라보는 "),s("code",[t._v("Load Balancer")]),t._v("가 필요합니다. 브라우저는 NodePort에 직접 요청을 보내는 것이 아니라 Load Balancer에 요청하고 Load Balancer가 알아서 살아 있는 노드에 접근하면 NodePort의 단점을 없앨 수 있습니다.")]),t._v(" "),s("p",[t._v("Load Balancer를 생성해 봅니다.")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("lb\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LoadBalancer\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" counter\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app\n")])])]),s("code-link",{attrs:{link:"guide/service/counter-lb.yml"}}),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("kubectl apply -f counter-lb.yml\n")])])]),s("p",[s("strong",[t._v("실행 결과")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("NAME         TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)           AGE\ncounter-lb   LoadBalancer   10.109.133.129   <pending>     30000:31535/TCP   9s\ncounter-np   NodePort       10.101.168.165   <none>        3000:31000/TCP    34m\nkubernetes   ClusterIP      10.96.0.1        <none>        443/TCP           3d20h\nredis        ClusterIP      10.103.50.102    <none>        6379/TCP          65m\n")])])]),s("p",[t._v("counter-lb가 생성되었지만, "),s("code",[t._v("EXTERNAL-IP")]),t._v("가 "),s("code",[t._v("<pending>")]),t._v("인 것을 확인할 수 있습니다. 사실 Load Balancer는 AWS, Google Cloud, Azure 같은 클라우드 환경이 아니면 사용이 제한적입니다. 특정 서버(노드)를 가리키는 무언가(Load Balancer)가 필요한데 이런 "),s("code",[t._v("무언가")]),t._v("가 가상머신이나 로컬 서버에는 존재하지 않습니다.")]),t._v(" "),s("h3",{attrs:{id:"minikube에-가상-loadbalancer-만들기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#minikube에-가상-loadbalancer-만들기"}},[t._v("#")]),t._v(" minikube에 가상 LoadBalancer 만들기")]),t._v(" "),s("p",[t._v("Load Balancer를 사용할 수 없는 환경에서 가상 환경을 만들어 주는 것이 "),s("code",[t._v("MetalLB")]),t._v("라는 것입니다. minikube에서는 현재 떠 있는 노드를 Load Balancer로 설정합니다. minikube의 "),s("code",[t._v("addons")]),t._v(" 명령어로 활성화합니다.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("minikube addons "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" metallb\n")])])]),s("p",[t._v("그리고 "),s("code",[t._v("minikube ip")]),t._v("명령어로 확인한 IP를 ConfigMap으로 지정해야 합니다.")]),t._v(" "),s("p",[t._v("minikube를 이용하여 손쉽게 metallb 설정을 할 수 있습니다.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("minikube addons configure metallb\n\n-- Enter Load Balancer Start IP: "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# minikube ip 결과값 입력")]),t._v("\n-- Enter Load Balancer End IP: "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# minikube ip 결과값 입력")]),t._v("\n    ▪ Using image metallb/speaker:v0.9.6\n    ▪ Using image metallb/controller:v0.9.6\n✅  metallb was successfully configured\n")])])]),s("p",[t._v("minikube를 사용하지 않고 직접 ConfigMap을 작성할 수도 있습니다.")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br")]),s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ConfigMap\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metallb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n    address-pools:\n    - name: default\n      protocol: layer2\n      addresses:\n      - 192.168.64.4/32 # minikube ip")]),t._v("\n")])])]),s("code-link",{attrs:{link:"guide/service/metallb-cm.yml"}}),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("kubectl apply -f metallb-cm.yml\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 다시 서비스 확인")]),t._v("\nkubectl get svc\n")])])]),s("p",[s("strong",[t._v("실행 결과")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("NAME         TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)           AGE\ncounter-lb   LoadBalancer   10.109.133.129   192.168.64.4  30000:31535/TCP   1m\ncounter-np   NodePort       10.101.168.165   <none>        3000:31000/TCP    35m\nkubernetes   ClusterIP      10.96.0.1        <none>        443/TCP           3d20h\nredis        ClusterIP      10.103.50.102    <none>        6379/TCP          66m\n")])])]),s("p",[t._v("이제 "),s("code",[t._v("192.168.64.4:30000")]),t._v("으로 접근해봅니다.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("Docker")]),t._v(" "),s("p",[t._v("Docker driver를 사용중이라면 "),s("code",[t._v("minikube service counter-lb")]),t._v(" 명령어를 이용하여 접속하세요.")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("LoadBalancer와 NodePort")]),t._v(" "),s("p",[t._v("LoadBalancer는 NodePort의 기능을 기본으로 포함합니다.")])]),t._v(" "),s("h2",{attrs:{id:"마무리"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#마무리"}},[t._v("#")]),t._v(" 마무리")]),t._v(" "),s("p",[t._v("서비스는 로우레벨"),s("sup",[t._v("low level")]),t._v(" 수준의 네트워크를 이해하고 성능, 보안 이슈를 신경 써야 합니다. 파고들면 한없이 복잡하고 어려운 부분으로 일단 그렇구나.. 하고 넘어갑니다. 😭")]),t._v(" "),s("p",[t._v("실전에선 NodePort와 LoadBalancer를 제한적으로 사용합니다. 보통 웹 애플리케이션을 배포하면 80 또는 443 포트를 사용하고 하나의 포트에서 여러 개의 서비스를 도메인이나 경로에 따라 다르게 연결하기 때문입니다. 이 부분은 뒤에 Ingress에서 자세히 알아봅니다.")]),t._v(" "),s("h2",{attrs:{id:"참고"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#참고"}},[t._v("#")]),t._v(" 참고")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#service-v1-core",target:"_blank",rel:"noopener noreferrer"}},[t._v("Service v1 core"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"https://matthewpalmer.net/kubernetes-app-developer/articles/kubernetes-networking-guide-beginners.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("네트워크 통신 시각화"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"문제"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#문제"}},[t._v("#")]),t._v(" 문제")]),t._v(" "),s("p",[s("strong",[t._v("문제1. echo 서비스를 NodePort로 32000 포트로 오픈합니다.")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("키")]),t._v(" "),s("th",[t._v("값")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("Deployment 이름")])]),t._v(" "),s("td",[t._v("echo")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("Deployment Label")])]),t._v(" "),s("td",[t._v("app: echo")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("Deployment 복제수")])]),t._v(" "),s("td",[t._v("3")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("Container 이름")])]),t._v(" "),s("td",[t._v("echo")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("Container 이미지")])]),t._v(" "),s("td",[t._v("ghcr.io/subicura/echo:v1")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("NodePort 이름")])]),t._v(" "),s("td",[t._v("echo")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("NodePort Port")])]),t._v(" "),s("td",[t._v("3000")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("NodePort NodePort")])]),t._v(" "),s("td",[t._v("32000")])])])]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("정답")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ghcr.io/subicura/echo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NodePort\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodePort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32000")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo\n")])])]),s("code-link",{attrs:{link:"guide/service/exam1.yml"}})],1)],1)}),[],!1,null,null,null);"function"==typeof n&&n(r);a.default=r.exports}}]);